<!DOCTYPE html>
<html>
  <body>
    <h2>Multi User Chat</h2>
    <input id="userId" placeholder="Enter your user ID" />
    <button id="registerBtn">Register</button>
    <br /><br />

    <h4>Private Message</h4>
    <input id="toUser" placeholder="To user ID" />
    <input id="privateMsg" placeholder="Message" />
    <button id="sendPrivate">Send</button>

    <h4>Group Chat</h4>
    <input id="roomName" placeholder="Room name" />
    <button id="joinRoom">Join Room</button>
    <input id="groupMsg" placeholder="Group message" />
    <button id="sendGroup">Send</button>

    <ul id="messages"></ul>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      let currentUser = "";

      // Register
      document.getElementById("registerBtn").onclick = () => {
        const userId = document.getElementById("userId").value.trim();
        if (!userId) return alert("Enter a user ID");
        currentUser = userId;
        socket.emit("register", userId);
      };

      // Send private message
      document.getElementById("sendPrivate").onclick = () => {
        const toUser = document.getElementById("toUser").value.trim();
        const message = document.getElementById("privateMsg").value.trim();
        if (!toUser || !message) return alert("Fill all fields");
        socket.emit("private_message", { to: toUser, message, from: currentUser });
        addMessage(`You (to ${toUser}): ${message}`);
      };

      // Join group
      document.getElementById("joinRoom").onclick = () => {
        const room = document.getElementById("roomName").value.trim();
        if (!room) return alert("Enter room name");
        socket.emit("join_room", room);
      };

      // Send group message
      document.getElementById("sendGroup").onclick = () => {
        const room = document.getElementById("roomName").value.trim();
        const message = document.getElementById("groupMsg").value.trim();
        if (!room || !message) return alert("Enter room and message");
        socket.emit("group_message", { room, from: currentUser, message });
        addMessage(`You (in ${room}): ${message}`);
      };

      // Listen for messages
      socket.on("registered", (msg) => addMessage(msg));
      socket.on("private_message", ({ from, message }) =>
        addMessage(`Private from ${from}: ${message}`)
      );
      socket.on("joined_room", (msg) => addMessage(msg));
      socket.on("group_message", ({ from, room, message }) =>
        addMessage(`${from} (in ${room}): ${message}`)
      );
      socket.on("error_message", (msg) => addMessage(`Error: ${msg}`));

      function addMessage(msg) {
        const li = document.createElement("li");
        li.textContent = msg;
        document.getElementById("messages").appendChild(li);
      }
    </script>
  </body>
</html>
